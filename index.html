<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Flower Market - –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</title>
    <style>
        /* ... (–≤—Å–µ CSS —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... */
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä -->
    <div class="container">
        <div class="progress-bar" id="progressBar">
            <div class="progress-step">
                <div class="step-number active">1</div>
                <div class="step-label active">–§–æ—Ç–æ</div>
            </div>
            <div class="progress-step">
                <div class="step-number">2</div>
                <div class="step-label">–û–ø–∏—Å–∞–Ω–∏–µ</div>
            </div>
            <div class="progress-step">
                <div class="step-number">3</div>
                <div class="step-label">–¶–µ–Ω–∞</div>
            </div>
            <div class="progress-step">
                <div class="step-number">4</div>
                <div class="step-label">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
            </div>
            <div class="progress-step">
                <div class="step-number">5</div>
                <div class="step-label">–õ–æ–∫–∞—Ü–∏—è</div>
            </div>
            <div class="progress-step">
                <div class="step-number">6</div>
                <div class="step-label">–ü—Ä–µ–≤—å—é</div>
            </div>
        </div>
        
        <div class="header">
            <h1><i class="fas fa-flower-tulip"></i> Flower Market</h1>
            <p>–°–æ–∑–¥–∞–π—Ç–µ –∫—Ä–∞—Å–∏–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –æ –ø—Ä–æ–¥–∞–∂–µ —Ü–≤–µ—Ç–æ–≤</p>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="notification" id="notification">
        <i class="fas fa-exclamation-circle notification-icon"></i>
        <div class="notification-content">
            <div class="notification-title" id="notificationTitle">–û—à–∏–±–∫–∞</div>
            <div class="notification-message" id="notificationMessage"></div>
        </div>
    </div>

    <!-- –§–æ—Ä–º–∞ -->
    <div class="container">
        <div class="form-container">
            <!-- –®–∞–≥ 1: –§–æ—Ç–æ -->
            <div class="form-step active" id="step1">
                <h2 class="step-title"><i class="fas fa-camera"></i> –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ</h2>
                <div class="form-group">
                    <div class="photo-upload" id="photoUpload" role="button" aria-label="–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ">
                        <i class="fas fa-cloud-upload-alt photo-upload-icon"></i>
                        <p>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ</p>
                        <p class="input-hint">–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ 10 —Ñ–æ—Ç–æ (–º–∞–∫—Å–∏–º—É–º 5MB –∫–∞–∂–¥–æ–µ)</p>
                    </div>
                    <input type="file" id="photoInput" accept="image/*" multiple>
                    <div id="photoPreview"></div>
                </div>
                <div class="navigation">
                    <button class="btn" onclick="nextStep()" id="nextBtn1">
                        –î–∞–ª–µ–µ <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
            
            <!-- –®–∞–≥ 2: –û–ø–∏—Å–∞–Ω–∏–µ -->
            <div class="form-step" id="step2">
                <h2 class="step-title"><i class="fas fa-edit"></i> –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</h2>
                <div class="form-group">
                    <label for="description">–û–ø–∏—à–∏—Ç–µ –≤–∞—à —Ç–æ–≤–∞—Ä –ø–æ–¥—Ä–æ–±–Ω–æ:</label>
                    <textarea id="description" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–≤–µ–∂–∏–µ —Ä–æ–∑—ã –∏–∑ –≠–∫–≤–∞–¥–æ—Ä–∞, –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è —Å–≤–∞–¥–µ–±–Ω—ã—Ö –±—É–∫–µ—Ç–æ–≤. –î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≥–æ—Ä–æ–¥—É."></textarea>
                    <p class="input-hint">–ú–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —É–∫–∞–∑–∞—Ç—å —Å–æ—Ä—Ç, —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏</p>
                </div>
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="prevStep()">
                        <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
                    </button>
                    <button class="btn" onclick="nextStep()" id="nextBtn2">
                        –î–∞–ª–µ–µ <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
            
            <!-- –®–∞–≥ 3: –¶–µ–Ω–∞ -->
            <div class="form-step" id="step3">
                <h2 class="step-title"><i class="fas fa-tag"></i> –£–∫–∞–∂–∏—Ç–µ —Ü–µ–Ω—É</h2>
                <div class="form-group">
                    <label for="price">–¶–µ–Ω–∞ –≤ —Å–æ–º–∞—Ö:</label>
                    <input type="text" id="price" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1500 –∏–ª–∏ –î–æ–≥–æ–≤–æ—Ä–Ω–∞—è">
                    <p class="input-hint">–ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω: 1000-1500, –∏–ª–∏ "–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è"</p>
                </div>
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="prevStep()">
                        <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
                    </button>
                    <button class="btn" onclick="nextStep()" id="nextBtn3">
                        –î–∞–ª–µ–µ <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
            
            <!-- –®–∞–≥ 4: –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
            <div class="form-step" id="step4">
                <h2 class="step-title"><i class="fas fa-phone"></i> –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —Å–≤—è–∑–∏</h2>
                <div class="contact-options">
                    <div class="contact-option active" id="telegramOption" onclick="selectContactType('telegram')" role="button">
                        <i class="fab fa-telegram"></i>
                        <p>Telegram</p>
                        <small>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–π username</small>
                    </div>
                    <div class="contact-option" id="phoneOption" onclick="selectContactType('phone')" role="button">
                        <i class="fas fa-mobile-alt"></i>
                        <p>–¢–µ–ª–µ—Ñ–æ–Ω</p>
                        <small>–í–≤–µ—Å—Ç–∏ –Ω–æ–º–µ—Ä</small>
                    </div>
                </div>
                <div class="form-group" id="phoneInputGroup" style="display: none;">
                    <label for="phone">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:</label>
                    <input type="tel" id="phone" placeholder="+996 XXX XXX XXX" pattern="^\+996\d{9}$">
                    <p class="input-hint">–§–æ—Ä–º–∞—Ç: +996XXXYYYZZZ (–±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤)</p>
                </div>
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="prevStep()">
                        <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
                    </button>
                    <button class="btn" onclick="nextStep()" id="nextBtn4">
                        –î–∞–ª–µ–µ <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
            
            <!-- –®–∞–≥ 5: –õ–æ–∫–∞—Ü–∏—è -->
            <div class="form-step" id="step5">
                <h2 class="step-title"><i class="fas fa-map-marker-alt"></i> –õ–æ–∫–∞—Ü–∏—è</h2>
                <div class="form-group">
                    <div class="location-map" id="map">
                        <i class="fas fa-map"></i>
                        <p style="margin-top: 10px; font-size: 14px;">–í–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</p>
                    </div>
                    <label for="locationInput">–ê–¥—Ä–µ—Å –∏–ª–∏ —Ä–∞–π–æ–Ω:</label>
                    <input type="text" id="locationInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –≥. –ë–∏—à–∫–µ–∫, —É–ª. –ß—É–π, 123">
                    <p class="input-hint" style="margin: 15px 0;">–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–∫—É—â—É—é –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é:</p>
                    <button class="btn btn-secondary" onclick="getCurrentLocation()" id="locationBtn">
                        <i class="fas fa-location-crosshairs"></i> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
                    </button>
                </div>
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="prevStep()">
                        <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
                    </button>
                    <button class="btn" onclick="nextStep()" id="nextBtn5">
                        –î–∞–ª–µ–µ <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
            
            <!-- –®–∞–≥ 6: –ü—Ä–µ–≤—å—é -->
            <div class="form-step" id="step6">
                <h2 class="step-title"><i class="fas fa-eye"></i> –ü—Ä–µ–≤—å—é –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h2>
                
                <div class="preview-item">
                    <div class="preview-label">–§–æ—Ç–æ</div>
                    <div id="previewPhotos" class="photos-grid"></div>
                </div>
                
                <div class="preview-item">
                    <div class="preview-label">–û–ø–∏—Å–∞–Ω–∏–µ</div>
                    <div class="preview-value" id="previewDescription"></div>
                </div>
                
                <div class="preview-item">
                    <div class="preview-label">–¶–µ–Ω–∞</div>
                    <div class="preview-value" id="previewPrice"></div>
                </div>
                
                <div class="preview-item">
                    <div class="preview-label">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
                    <div class="preview-value" id="previewContacts"></div>
                </div>
                
                <div class="preview-item">
                    <div class="preview-label">–õ–æ–∫–∞—Ü–∏—è</div>
                    <div class="preview-value" id="previewLocation"></div>
                </div>
                
                <div class="preview-item">
                    <div class="preview-label">–°—Ç–æ–∏–º–æ—Å—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</div>
                    <div class="preview-value">50 —Å–æ–º</div>
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="prevStep()">
                        <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
                    </button>
                    <button class="btn" onclick="submitForm()" id="submitBtn">
                        –û—Ç–ø—Ä–∞–≤–∏—Ç—å <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Telegram Web App –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
        let tg = null;
        let isTelegramWebApp = false;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Ç–∫—Ä—ã—Ç–æ –ª–∏ –≤ Telegram Web App
        if (window.Telegram && window.Telegram.WebApp) {
            tg = window.Telegram.WebApp;
            isTelegramWebApp = true;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
            tg.expand();
            tg.enableClosingConfirmation();
            tg.MainButton.hide();
            tg.BackButton.hide();
        } else {
            console.warn('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ –Ω–µ —á–µ—Ä–µ–∑ Telegram. –†–µ–∂–∏–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.');
            // –°–æ–∑–¥–∞–µ–º –∑–∞–≥–ª—É—à–∫—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            tg = {
                expand: () => console.log('Telegram: expand'),
                enableClosingConfirmation: () => console.log('Telegram: enableClosingConfirmation'),
                MainButton: {
                    hide: () => console.log('Telegram MainButton: hide'),
                    show: () => console.log('Telegram MainButton: show'),
                    showProgress: () => console.log('Telegram MainButton: showProgress'),
                    hideProgress: () => console.log('Telegram MainButton: hideProgress'),
                    setText: (text) => console.log('Telegram MainButton setText:', text),
                    onClick: (callback) => console.log('Telegram MainButton onClick set'),
                    offClick: (callback) => console.log('Telegram MainButton offClick')
                },
                BackButton: {
                    hide: () => console.log('Telegram BackButton: hide'),
                    show: () => console.log('Telegram BackButton: show'),
                    onClick: (callback) => console.log('Telegram BackButton onClick set')
                },
                sendData: (data) => {
                    console.log('Telegram sendData (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º):', JSON.parse(data));
                    alert('–í —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è. –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞.');
                },
                close: () => {
                    console.log('Telegram: close');
                    alert('–í —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–∫—Ä–æ–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.');
                },
                initDataUnsafe: {
                    user: {
                        id: 123456789,
                        username: 'test_user',
                        first_name: '–¢–µ—Å—Ç–æ–≤—ã–π',
                        last_name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
                    }
                }
            };
        }
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let formData = {
            photos: [],
            description: '',
            price: '',
            contact_type: 'telegram',
            contacts: '',
            location: { type: 'none', address: '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }
        };
        
        let currentStep = 1;
        const totalSteps = 6;
        const MAX_PHOTOS = 10;
        const MAX_PHOTO_SIZE = 5 * 1024 * 1024; // 5MB
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            setupEventListeners();
            updateProgressBar();
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º Telegram username
            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                const user = tg.initDataUnsafe.user;
                if (user.username) {
                    formData.contacts = `@${user.username}`;
                    console.log('Telegram username detected:', user.username);
                } else {
                    // –ï—Å–ª–∏ –Ω–µ—Ç username, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω
                    showNotification('–í–Ω–∏–º–∞–Ω–∏–µ', '–£ –≤–∞—Å –Ω–µ—Ç username –≤ Telegram. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏.', 'warning');
                    selectContactType('phone');
                }
            } else {
                console.warn('Telegram user data not available');
                if (isTelegramWebApp) {
                    showNotification('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', '–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –æ—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞.', 'info');
                }
            }
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –≤ Telegram
            if (isTelegramWebApp) {
                tg.BackButton.onClick(handleTelegramBack);
            }
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ
            document.getElementById('photoUpload').addEventListener('click', () => {
                document.getElementById('photoInput').click();
            });
            
            document.getElementById('photoInput').addEventListener('change', handlePhotoUpload);
            
            // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –≤–≤–æ–¥–µ
            document.getElementById('description').addEventListener('input', debounce(() => {
                formData.description = document.getElementById('description').value;
            }, 500));
            
            document.getElementById('price').addEventListener('input', debounce(() => {
                formData.price = document.getElementById('price').value;
            }, 300));
            
            document.getElementById('phone').addEventListener('input', debounce(() => {
                if (formData.contact_type === 'phone') {
                    formData.contacts = document.getElementById('phone').value;
                }
            }, 300));
            
            document.getElementById('locationInput').addEventListener('input', debounce(() => {
                const value = document.getElementById('locationInput').value;
                if (value) {
                    formData.location = {
                        type: 'address',
                        address: value
                    };
                }
            }, 500));
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Enter –≤ –ø–æ–ª—è—Ö –≤–≤–æ–¥–∞
            document.getElementById('description').addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey && currentStep === 2) {
                    e.preventDefault();
                    nextStep();
                }
            });
            
            document.getElementById('price').addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && currentStep === 3) {
                    e.preventDefault();
                    nextStep();
                }
            });
            
            document.getElementById('phone').addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && currentStep === 4 && formData.contact_type === 'phone') {
                    e.preventDefault();
                    nextStep();
                }
            });
            
            document.getElementById('locationInput').addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && currentStep === 5) {
                    e.preventDefault();
                    nextStep();
                }
            });
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –≤ Telegram
        function handleTelegramBack() {
            if (currentStep > 1) {
                prevStep();
            } else {
                tg.close();
            }
        }
        
        // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification(title, message, type = 'error') {
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notificationTitle');
            const notificationMessage = document.getElementById('notificationMessage');
            const icon = notification.querySelector('.notification-icon');
            
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∫–æ–Ω–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            notification.className = 'notification';
            if (type === 'success') {
                notification.classList.add('success');
                icon.className = 'fas fa-check-circle notification-icon';
            } else if (type === 'warning') {
                icon.className = 'fas fa-exclamation-triangle notification-icon';
            } else if (type === 'info') {
                icon.className = 'fas fa-info-circle notification-icon';
            } else {
                icon.className = 'fas fa-exclamation-circle notification-icon';
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            notification.classList.add('show');
            
            // –°–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
        function handlePhotoUpload(event) {
            const files = Array.from(event.target.files);
            const preview = document.getElementById('photoPreview');
            const currentCount = formData.photos.length;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ —Ñ–æ—Ç–æ
            if (currentCount + files.length > MAX_PHOTOS) {
                showNotification('–û—à–∏–±–∫–∞', `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ—Ç–æ: ${MAX_PHOTOS}. –£ –≤–∞—Å —É–∂–µ ${currentCount} —Ñ–æ—Ç–æ.`);
                event.target.value = '';
                return;
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞
            files.forEach(file => {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞
                if (file.size > MAX_PHOTO_SIZE) {
                    showNotification('–û—à–∏–±–∫–∞', `–§–æ—Ç–æ "${file.name}" —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ (${(file.size/1024/1024).toFixed(1)}MB). –ú–∞–∫—Å–∏–º—É–º 5MB.`);
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
                if (!file.type.startsWith('image/')) {
                    showNotification('–û—à–∏–±–∫–∞', `–§–∞–π–ª "${file.name}" –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º.`);
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ –≤ –¥–∞–Ω–Ω—ã–µ
                    formData.photos.push(e.target.result);
                    
                    // –°–æ–∑–¥–∞–µ–º –ø—Ä–µ–≤—å—é
                    createPhotoPreview(e.target.result, formData.photos.length - 1);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
                    updatePhotoCounter();
                };
                
                reader.readAsDataURL(file);
            });
            
            // –û—á–∏—â–∞–µ–º input
            event.target.value = '';
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–≤—å—é —Ñ–æ—Ç–æ
        function createPhotoPreview(dataUrl, index) {
            const preview = document.getElementById('photoPreview');
            
            const photoItem = document.createElement('div');
            photoItem.className = 'photo-item';
            photoItem.setAttribute('data-index', index);
            
            const img = document.createElement('img');
            img.src = dataUrl;
            img.alt = `–§–æ—Ç–æ ${index + 1}`;
            img.loading = 'lazy';
            
            const removeBtn = document.createElement('div');
            removeBtn.className = 'remove-photo';
            removeBtn.innerHTML = '√ó';
            removeBtn.setAttribute('aria-label', '–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ');
            removeBtn.onclick = (e) => {
                e.stopPropagation();
                removePhoto(index);
            };
            
            photoItem.appendChild(img);
            photoItem.appendChild(removeBtn);
            preview.appendChild(photoItem);
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ
        function removePhoto(index) {
            formData.photos.splice(index, 1);
            updatePhotoPreview();
            updatePhotoCounter();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–µ–≤—å—é —Ñ–æ—Ç–æ
        function updatePhotoPreview() {
            const preview = document.getElementById('photoPreview');
            preview.innerHTML = '';
            
            formData.photos.forEach((photo, index) => {
                createPhotoPreview(photo, index);
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —Ñ–æ—Ç–æ
        function updatePhotoCounter() {
            const photoUpload = document.getElementById('photoUpload');
            const photoCount = formData.photos.length;
            
            if (photoCount > 0) {
                photoUpload.innerHTML = `
                    <i class="fas fa-check-circle photo-upload-icon" style="color: #34c759;"></i>
                    <p>–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–æ—Ç–æ: ${photoCount}</p>
                    <p class="input-hint">–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –µ—â–µ ${MAX_PHOTOS - photoCount} —Ñ–æ—Ç–æ</p>
                `;
            } else {
                photoUpload.innerHTML = `
                    <i class="fas fa-cloud-upload-alt photo-upload-icon"></i>
                    <p>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ</p>
                    <p class="input-hint">–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ ${MAX_PHOTOS} —Ñ–æ—Ç–æ (–º–∞–∫—Å–∏–º—É–º 5MB –∫–∞–∂–¥–æ–µ)</p>
                `;
            }
        }
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —à–∞–≥–∞–º
        function showStep(step) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
            saveCurrentStepData();
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —à–∞–≥–∏
            for (let i = 1; i <= totalSteps; i++) {
                const stepElement = document.getElementById(`step${i}`);
                if (stepElement) {
                    stepElement.classList.remove('active');
                }
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —à–∞–≥
            const currentStepElement = document.getElementById(`step${step}`);
            if (currentStepElement) {
                currentStepElement.classList.add('active');
            }
            
            currentStep = step;
            updateProgressBar();
            updateTelegramButtons();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º —à–∞–≥–µ
            if (step === 6) {
                updatePreview();
            }
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –≤–µ—Ä—Ö—É
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥
        function nextStep() {
            // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
            if (!validateStep(currentStep)) {
                return;
            }
            
            if (currentStep < totalSteps) {
                showStep(currentStep + 1);
            }
        }
        
        // –ü—Ä–µ–¥—ã–¥—É—â–∏–π —à–∞–≥
        function prevStep() {
            if (currentStep > 1) {
                showStep(currentStep - 1);
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
        function saveCurrentStepData() {
            switch(currentStep) {
                case 1:
                    // –§–æ—Ç–æ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
                    break;
                case 2:
                    formData.description = document.getElementById('description').value.trim();
                    break;
                case 3:
                    formData.price = document.getElementById('price').value.trim();
                    break;
                case 4:
                    if (formData.contact_type === 'phone') {
                        formData.contacts = document.getElementById('phone').value.trim();
                    }
                    break;
                case 5:
                    const locationInput = document.getElementById('locationInput').value.trim();
                    if (locationInput) {
                        formData.location = {
                            type: 'address',
                            address: locationInput
                        };
                    }
                    break;
            }
        }
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è —à–∞–≥–æ–≤
        function validateStep(step) {
            switch(step) {
                case 1:
                    if (formData.photos.length === 0) {
                        showNotification('–û—à–∏–±–∫–∞', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Ñ–æ—Ç–æ');
                        return false;
                    }
                    break;
                    
                case 2:
                    const description = document.getElementById('description').value.trim();
                    if (!description) {
                        showNotification('–û—à–∏–±–∫–∞', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞');
                        return false;
                    }
                    if (description.length < 10) {
                        showNotification('–û—à–∏–±–∫–∞', '–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤');
                        return false;
                    }
                    formData.description = description;
                    break;
                    
                case 3:
                    const price = document.getElementById('price').value.trim();
                    if (!price) {
                        showNotification('–û—à–∏–±–∫–∞', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ —Ü–µ–Ω—É');
                        return false;
                    }
                    formData.price = price;
                    break;
                    
                case 4:
                    if (formData.contact_type === 'phone') {
                        const phone = document.getElementById('phone').value.trim();
                        const phoneRegex = /^\+996\d{9}$/;
                        
                        if (!phone) {
                            showNotification('–û—à–∏–±–∫–∞', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
                            return false;
                        }
                        
                        if (!phoneRegex.test(phone)) {
                            showNotification('–û—à–∏–±–∫–∞', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ +996XXXXXXXXX');
                            return false;
                        }
                        
                        formData.contacts = phone;
                    }
                    break;
                    
                case 5:
                    const locationInput = document.getElementById('locationInput').value.trim();
                    if (locationInput) {
                        formData.location = {
                            type: 'address',
                            address: locationInput
                        };
                    } else if (!formData.location.address || formData.location.address === '–ù–µ —É–∫–∞–∑–∞–Ω–æ') {
                        // –ú–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é
                        formData.location = {
                            type: 'none',
                            address: '–ù–µ —É–∫–∞–∑–∞–Ω–æ'
                        };
                    }
                    break;
            }
            
            return true;
        }
        
        // –í—ã–±–æ—Ä —Ç–∏–ø–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
        function selectContactType(type) {
            formData.contact_type = type;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            document.getElementById('telegramOption').classList.remove('active');
            document.getElementById('phoneOption').classList.remove('active');
            document.getElementById(`${type}Option`).classList.add('active');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
            const phoneInputGroup = document.getElementById('phoneInputGroup');
            phoneInputGroup.style.display = type === 'phone' ? 'block' : 'none';
            
            // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω Telegram, –∏—Å–ø–æ–ª—å–∑—É–µ–º username –µ—Å–ª–∏ –µ—Å—Ç—å
            if (type === 'telegram' && tg.initDataUnsafe && tg.initDataUnsafe.user) {
                const username = tg.initDataUnsafe.user.username;
                if (username) {
                    formData.contacts = `@${username}`;
                }
            }
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
        function getCurrentLocation() {
            const locationBtn = document.getElementById('locationBtn');
            const originalText = locationBtn.innerHTML;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            locationBtn.innerHTML = '<div class="loader"></div> –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ...';
            locationBtn.disabled = true;
            
            if (!navigator.geolocation) {
                showNotification('–û—à–∏–±–∫–∞', '–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é');
                resetLocationButton(locationBtn, originalText);
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                // –£—Å–ø–µ—Ö
                async function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                    formData.location = {
                        type: 'coordinates',
                        latitude: lat,
                        longitude: lng,
                        address: ''
                    };
                    
                    // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∞–¥—Ä–µ—Å
                    try {
                        const address = await getAddressFromCoords(lat, lng);
                        if (address) {
                            formData.location.address = address;
                            document.getElementById('locationInput').value = address;
                            locationBtn.innerHTML = '<i class="fas fa-check"></i> –ê–¥—Ä–µ—Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω';
                        } else {
                            locationBtn.innerHTML = '<i class="fas fa-check"></i> –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—É—á–µ–Ω—ã';
                            document.getElementById('locationInput').value = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                            formData.location.address = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                        }
                    } catch (error) {
                        console.error('Error getting address:', error);
                        locationBtn.innerHTML = '<i class="fas fa-check"></i> –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—É—á–µ–Ω—ã';
                        document.getElementById('locationInput').value = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                        formData.location.address = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                    }
                    
                    // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        resetLocationButton(locationBtn, originalText);
                    }, 2000);
                },
                // –û—à–∏–±–∫–∞
                function(error) {
                    let errorMessage = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = '–í—ã –æ—Ç–∫–∞–∑–∞–ª–∏ –≤ –¥–æ—Å—Ç—É–ø–µ –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.';
                            break;
                        case error.TIMEOUT:
                            errorMessage = '–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.';
                            break;
                    }
                    showNotification('–û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏', errorMessage);
                    resetLocationButton(locationBtn, originalText);
                },
                // –û–ø—Ü–∏–∏
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }
        
        // –°–±—Ä–æ—Å –∫–Ω–æ–ø–∫–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
        function resetLocationButton(button, originalText) {
            setTimeout(() => {
                button.innerHTML = originalText;
                button.disabled = false;
            }, 1000);
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
        async function getAddressFromCoords(lat, lng) {
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=18&addressdetails=1`,
                    {
                        headers: {
                            'User-Agent': 'FlowerMarketBot/1.0',
                            'Accept-Language': 'ru,en-US;q=0.9,en;q=0.8'
                        }
                    }
                );
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.display_name) {
                    // –£–ø—Ä–æ—â–∞–µ–º –∞–¥—Ä–µ—Å
                    const addressParts = data.display_name.split(',');
                    if (addressParts.length > 3) {
                        return addressParts.slice(0, 3).join(', ');
                    }
                    return data.display_name;
                }
                
                return null;
            } catch (error) {
                console.error('Error fetching address:', error);
                return null;
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é
        function updatePreview() {
            // –§–æ—Ç–æ
            const previewPhotos = document.getElementById('previewPhotos');
            previewPhotos.innerHTML = '';
            
            const photosToShow = formData.photos.slice(0, 6); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∞–∫—Å–∏–º—É–º 6 —Ñ–æ—Ç–æ
            
            photosToShow.forEach((photo, index) => {
                const img = document.createElement('img');
                img.className = 'photo-preview';
                img.src = photo;
                img.alt = `–§–æ—Ç–æ ${index + 1}`;
                img.loading = 'lazy';
                previewPhotos.appendChild(img);
            });
            
            // –ï—Å–ª–∏ —Ñ–æ—Ç–æ –±–æ–ª—å—à–µ 6, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫
            if (formData.photos.length > 6) {
                const moreCount = document.createElement('div');
                moreCount.className = 'photo-preview photo-more';
                moreCount.textContent = `+${formData.photos.length - 6}`;
                previewPhotos.appendChild(moreCount);
            }
            
            // –û–ø–∏—Å–∞–Ω–∏–µ
            const previewDescription = document.getElementById('previewDescription');
            previewDescription.textContent = formData.description || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            
            // –¶–µ–Ω–∞
            const previewPrice = document.getElementById('previewPrice');
            previewPrice.textContent = formData.price || '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
            
            // –ö–æ–Ω—Ç–∞–∫—Ç—ã
            const previewContacts = document.getElementById('previewContacts');
            let contactsText = '';
            if (formData.contact_type === 'telegram') {
                contactsText = `Telegram: ${formData.contacts || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}`;
            } else {
                contactsText = `–¢–µ–ª–µ—Ñ–æ–Ω: ${formData.contacts || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}`;
            }
            previewContacts.textContent = contactsText;
            
            // –õ–æ–∫–∞—Ü–∏—è
            const previewLocation = document.getElementById('previewLocation');
            let locationText = '';
            if (formData.location.type === 'coordinates') {
                locationText = `üìç –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è: ${formData.location.address || '–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—É—á–µ–Ω—ã'}`;
            } else if (formData.location.type === 'address') {
                locationText = `üìç –ê–¥—Ä–µ—Å: ${formData.location.address}`;
            } else {
                locationText = 'üìç –ù–µ —É–∫–∞–∑–∞–Ω–∞';
            }
            previewLocation.textContent = locationText;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä–∞
        function updateProgressBar() {
            const stepNumbers = document.querySelectorAll('.step-number');
            const stepLabels = document.querySelectorAll('.step-label');
            
            stepNumbers.forEach((number, index) => {
                if (index + 1 === currentStep) {
                    number.classList.add('active');
                } else {
                    number.classList.remove('active');
                }
            });
            
            stepLabels.forEach((label, index) => {
                if (index + 1 <= currentStep) {
                    label.classList.add('active');
                } else {
                    label.classList.remove('active');
                }
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ Telegram
        function updateTelegramButtons() {
            if (!isTelegramWebApp) return;
            
            if (currentStep > 1) {
                tg.BackButton.show();
            } else {
                tg.BackButton.hide();
            }
            
            // –ù–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º —à–∞–≥–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º MainButton
            if (currentStep === totalSteps) {
                tg.MainButton.setText("–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ");
                tg.MainButton.onClick(submitForm);
                tg.MainButton.show();
            } else {
                tg.MainButton.hide();
                tg.MainButton.offClick(submitForm);
            }
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
        async function submitForm() {
            // –§–∏–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
            if (!validateStep(currentStep)) {
                return;
            }
            
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            submitBtn.innerHTML = '<div class="loader"></div> –û—Ç–ø—Ä–∞–≤–∫–∞...';
            submitBtn.disabled = true;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤ Telegram
            if (isTelegramWebApp) {
                tg.MainButton.showProgress();
            }
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
                if (!formData.description || !formData.price || !formData.contacts) {
                    throw new Error('–ù–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã');
                }
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                const finalData = {
                    ...formData,
                    timestamp: new Date().toISOString(),
                    user_id: tg.initDataUnsafe?.user?.id || 'unknown',
                    username: tg.initDataUnsafe?.user?.username || 'unknown'
                };
                
                console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:', finalData);
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Telegram
                if (isTelegramWebApp) {
                    tg.sendData(JSON.stringify(finalData));
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                    showNotification('–£—Å–ø–µ—à–Ω–æ', '–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.', 'success');
                    
                    // –ñ–¥–µ–º 2 —Å–µ–∫—É–Ω–¥—ã –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º
                    setTimeout(() => {
                        tg.close();
                    }, 2000);
                } else {
                    // –†–µ–∂–∏–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    showNotification('–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º', '–î–∞–Ω–Ω—ã–µ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω—ã, –Ω–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã. –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞.', 'info');
                    
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
                
            } catch (error) {
                console.error('Error submitting form:', error);
                showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                if (isTelegramWebApp) {
                    tg.MainButton.hideProgress();
                }
            }
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        selectContactType('telegram');
    </script>
</body>
</html>