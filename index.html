<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Flower Market - –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</title>
    <!-- –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .container { max-width: 800px; margin: 0 auto; padding-bottom: env(safe-area-inset-bottom, 20px); }
        .header { text-align: center; color: white; margin-bottom: 30px; padding-top: env(safe-area-inset-top, 0); }
        .header h1 { font-size: 24px; margin-bottom: 8px; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .header p { opacity: 0.9; font-size: 14px; }
        .form-container { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); margin-bottom: 20px; }
        .form-step { display: none; animation-duration: 0.3s; animation-fill-mode: both; }
        .form-step.active { display: block; animation-name: fadeInUp; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .step-title { font-size: 20px; color: #333; margin-bottom: 25px; text-align: center; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .form-group { margin-bottom: 25px; }
        label { display: block; margin-bottom: 10px; color: #555; font-weight: 500; font-size: 15px; }
        .input-wrapper { position: relative; }
        input, textarea, select { width: 100%; padding: 14px 16px; border: 2px solid #e0e0e0; border-radius: 12px; font-size: 16px; font-family: inherit; transition: all 0.3s ease; background: #fff; }
        input:focus, textarea:focus, select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        textarea { min-height: 140px; resize: vertical; line-height: 1.5; }
        .input-hint { display: block; margin-top: 8px; color: #888; font-size: 13px; }
        .photo-upload { border: 3px dashed #667eea; border-radius: 12px; padding: 40px 20px; text-align: center; cursor: pointer; transition: all 0.3s ease; background: rgba(102, 126, 234, 0.05); }
        .photo-upload:hover, .photo-upload:active { background: rgba(102, 126, 234, 0.1); }
        .photo-upload-icon { font-size: 48px; color: #667eea; margin-bottom: 15px; display: block; }
        #photoInput { display: none; }
        #photoPreview { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 20px; }
        .photo-item { position: relative; width: 100px; height: 100px; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: transform 0.2s ease; }
        .photo-item:hover { transform: scale(1.05); }
        .photo-item img { width: 100%; height: 100%; object-fit: cover; }
        .remove-photo { position: absolute; top: 6px; right: 6px; background: rgba(255, 59, 48, 0.9); color: white; width: 26px; height: 26px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 16px; font-weight: bold; transition: background 0.2s; border: 2px solid white; }
        .remove-photo:hover { background: rgba(255, 59, 48, 1); }
        .contact-options { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        @media (max-width: 480px) { .contact-options { grid-template-columns: 1fr; } }
        .contact-option { padding: 20px 15px; border: 2px solid #e0e0e0; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.3s ease; background: #fff; }
        .contact-option:hover { border-color: #667eea; background: rgba(102, 126, 234, 0.05); }
        .contact-option.active { border-color: #667eea; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3); }
        .contact-option i { font-size: 28px; margin-bottom: 12px; display: block; }
        .contact-option p { font-size: 15px; font-weight: 500; margin-bottom: 5px; }
        .contact-option small { font-size: 12px; opacity: 0.8; }
        .location-map { width: 100%; height: 200px; border-radius: 12px; overflow: hidden; margin-bottom: 20px; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; color: #667eea; border: 2px solid #e0e0e0; }
        .location-map i { font-size: 48px; margin-bottom: 10px; }
        .btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 16px 30px; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; width: 100%; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 10px; position: relative; overflow: hidden; }
        .btn:after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, transparent 100%); opacity: 0; transition: opacity 0.3s; }
        .btn:hover:after, .btn:active:after { opacity: 1; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4); }
        .btn:active { transform: translateY(0); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none !important; box-shadow: none !important; }
        .btn-secondary { background: #f0f0f0; color: #333; background-image: none; }
        .btn-secondary:hover { background: #e0e0e0; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .navigation { display: flex; gap: 15px; margin-top: 30px; }
        .navigation .btn { flex: 1; }
        .preview-item { background: rgba(102, 126, 234, 0.05); padding: 18px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid #667eea; }
        .preview-label { font-weight: 600; color: #667eea; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; }
        .preview-value { color: #333; font-size: 16px; line-height: 1.5; }
        .photos-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .photo-preview { width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .photo-more { display: flex; align-items: center; justify-content: center; background: rgba(102, 126, 234, 0.1); border-radius: 8px; font-size: 20px; font-weight: bold; color: #667eea; }
        .progress-bar { display: flex; justify-content: space-between; margin-bottom: 30px; position: relative; }
        .progress-bar:before { content: ''; position: absolute; top: 15px; left: 0; right: 0; height: 3px; background: rgba(255,255,255,0.3); z-index: 1; }
        .progress-step { position: relative; z-index: 2; text-align: center; flex: 1; }
        .step-number { width: 36px; height: 36px; background: rgba(255,255,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 8px; color: white; font-weight: 600; transition: all 0.3s; }
        .step-number.active { background: white; color: #667eea; box-shadow: 0 0 0 4px rgba(255,255,255,0.3); }
        .step-label { color: rgba(255,255,255,0.7); font-size: 12px; transition: color 0.3s; }
        .step-label.active { color: white; font-weight: 500; }
        .notification { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px); background: white; padding: 15px 20px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); z-index: 1000; display: flex; align-items: center; gap: 12px; transition: transform 0.4s ease; max-width: 90%; width: 400px; }
        .notification.show { transform: translateX(-50%) translateY(0); }
        .notification-icon { font-size: 22px; color: #ff3b30; }
        .notification.success .notification-icon { color: #34c759; }
        .notification-content { flex: 1; }
        .notification-title { font-weight: 600; margin-bottom: 4px; color: #333; }
        .notification-message { color: #666; font-size: 14px; }
        .loader { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @media (max-width: 600px) { body { padding: 15px; } .form-container { padding: 20px; border-radius: 16px; } .step-title { font-size: 18px; } .photo-item { width: 80px; height: 80px; } .btn { padding: 14px 20px; font-size: 15px; } }
        @media (max-width: 380px) { .photos-grid { grid-template-columns: repeat(2, 1fr); } }
        .success-screen { text-align: center; padding: 40px 20px; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .success-icon { font-size: 80px; color: #34c759; margin-bottom: 25px; animation: bounce 1s ease infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .success-title { font-size: 28px; color: #333; margin-bottom: 15px; font-weight: 600; }
        .success-message { color: #666; line-height: 1.6; margin-bottom: 30px; font-size: 16px; }
        .success-steps { background: rgba(102, 126, 234, 0.05); border-radius: 12px; padding: 20px; margin: 30px 0; text-align: left; }
        .success-step { display: flex; align-items: flex-start; margin-bottom: 15px; }
        .success-step:last-child { margin-bottom: 0; }
        .step-badge { background: #667eea; color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 12px; flex-shrink: 0; }
        .step-text { flex: 1; color: #555; }
        .error-screen { text-align: center; padding: 40px 20px; }
        .error-icon { font-size: 80px; color: #ff3b30; margin-bottom: 25px; }
        .error-title { font-size: 28px; color: #333; margin-bottom: 15px; font-weight: 600; }
        .error-message { color: #666; line-height: 1.6; margin-bottom: 30px; font-size: 16px; }
        .error-details { background: rgba(255, 59, 48, 0.05); border-radius: 12px; padding: 15px; margin: 20px 0; font-family: monospace; font-size: 12px; color: #ff3b30; text-align: left; max-height: 150px; overflow-y: auto; }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div id="mainContent">
        <div class="container">
            <div class="progress-bar" id="progressBar">
                <div class="progress-step"><div class="step-number active">1</div><div class="step-label active">–§–æ—Ç–æ</div></div>
                <div class="progress-step"><div class="step-number">2</div><div class="step-label">–û–ø–∏—Å–∞–Ω–∏–µ</div></div>
                <div class="progress-step"><div class="step-number">3</div><div class="step-label">–¶–µ–Ω–∞</div></div>
                <div class="progress-step"><div class="step-number">4</div><div class="step-label">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div></div>
                <div class="progress-step"><div class="step-number">5</div><div class="step-label">–õ–æ–∫–∞—Ü–∏—è</div></div>
                <div class="progress-step"><div class="step-number">6</div><div class="step-label">–ü—Ä–µ–≤—å—é</div></div>
            </div>
            
            <div class="header">
                <h1><i class="fas fa-flower-tulip"></i> Flower Market</h1>
                <p>–°–æ–∑–¥–∞–π—Ç–µ –∫—Ä–∞—Å–∏–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –æ –ø—Ä–æ–¥–∞–∂–µ —Ü–≤–µ—Ç–æ–≤</p>
            </div>
        </div>

        <div class="notification" id="notification">
            <i class="fas fa-exclamation-circle notification-icon"></i>
            <div class="notification-content">
                <div class="notification-title" id="notificationTitle">–û—à–∏–±–∫–∞</div>
                <div class="notification-message" id="notificationMessage"></div>
            </div>
        </div>

        <div class="container">
            <!-- –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞ -->
            <div class="form-container" id="formContainer">
                <div class="form-step active" id="step1">
                    <h2 class="step-title"><i class="fas fa-camera"></i> –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ</h2>
                    <div class="form-group">
                        <div class="photo-upload" id="photoUpload">
                            <i class="fas fa-cloud-upload-alt photo-upload-icon"></i>
                            <p>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ</p>
                            <p class="input-hint">–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ 10 —Ñ–æ—Ç–æ</p>
                        </div>
                        <input type="file" id="photoInput" accept="image/*" multiple>
                        <div id="photoPreview"></div>
                    </div>
                    <button class="btn" onclick="nextStep()">–î–∞–ª–µ–µ ‚Üí</button>
                </div>
                
                <div class="form-step" id="step2">
                    <h2 class="step-title"><i class="fas fa-edit"></i> –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</h2>
                    <div class="form-group">
                        <label for="description">–û–ø–∏—à–∏—Ç–µ –≤–∞—à —Ç–æ–≤–∞—Ä:</label>
                        <textarea id="description" placeholder="–°–≤–µ–∂–∏–µ —Ä–æ–∑—ã –∏–∑ –≠–∫–≤–∞–¥–æ—Ä–∞..."></textarea>
                        <p class="input-hint">–ú–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤</p>
                    </div>
                    <div class="navigation">
                        <button class="btn btn-secondary" onclick="prevStep()">‚Üê –ù–∞–∑–∞–¥</button>
                        <button class="btn" onclick="nextStep()">–î–∞–ª–µ–µ ‚Üí</button>
                    </div>
                </div>
                
                <div class="form-step" id="step3">
                    <h2 class="step-title"><i class="fas fa-tag"></i> –£–∫–∞–∂–∏—Ç–µ —Ü–µ–Ω—É</h2>
                    <div class="form-group">
                        <label for="price">–¶–µ–Ω–∞ –≤ —Å–æ–º–∞—Ö:</label>
                        <input type="text" id="price" placeholder="1500 –∏–ª–∏ –î–æ–≥–æ–≤–æ—Ä–Ω–∞—è">
                    </div>
                    <div class="navigation">
                        <button class="btn btn-secondary" onclick="prevStep()">‚Üê –ù–∞–∑–∞–¥</button>
                        <button class="btn" onclick="nextStep()">–î–∞–ª–µ–µ ‚Üí</button>
                    </div>
                </div>
                
                <div class="form-step" id="step4">
                    <h2 class="step-title"><i class="fas fa-phone"></i> –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —Å–≤—è–∑–∏</h2>
                    <div class="form-group">
                        <label>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∫–æ–Ω—Ç–∞–∫—Ç–∞:</label>
                        <div style="display: flex; gap: 10px; margin: 15px 0;">
                            <button type="button" id="btnTelegram" onclick="selectContactType('telegram')" style="flex: 1; padding: 15px; border: 2px solid #0088cc; background: #0088cc; color: white; border-radius: 10px; font-weight: bold;">
                                Telegram
                            </button>
                            <button type="button" id="btnPhone" onclick="selectContactType('phone')" style="flex: 1; padding: 15px; border: 2px solid #e0e0e0; background: #f8f8f8; color: #333; border-radius: 10px; font-weight: bold;">
                                –¢–µ–ª–µ—Ñ–æ–Ω
                            </button>
                        </div>
                        <div id="phoneInput" style="display: none;">
                            <input type="tel" id="phone" placeholder="+996 555 123456">
                        </div>
                        <div id="telegramInfo" style="background: #e8f4fc; padding: 12px; border-radius: 8px; margin-top: 10px; border-left: 4px solid #0088cc; display: none;">
                            <i class="fab fa-telegram"></i> –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤–∞—à Telegram username
                        </div>
                    </div>
                    <div class="navigation">
                        <button class="btn btn-secondary" onclick="prevStep()">‚Üê –ù–∞–∑–∞–¥</button>
                        <button class="btn" onclick="nextStep()">–î–∞–ª–µ–µ ‚Üí</button>
                    </div>
                </div>
                
                <div class="form-step" id="step5">
                    <h2 class="step-title"><i class="fas fa-map-marker-alt"></i> –õ–æ–∫–∞—Ü–∏—è</h2>
                    <div class="form-group">
                        <label for="locationInput">–ê–¥—Ä–µ—Å –∏–ª–∏ —Ä–∞–π–æ–Ω:</label>
                        <input type="text" id="locationInput" placeholder="–≥. –ë–∏—à–∫–µ–∫, —É–ª. –ß—É–π, 123">
                    </div>
                    <div class="navigation">
                        <button class="btn btn-secondary" onclick="prevStep()">‚Üê –ù–∞–∑–∞–¥</button>
                        <button class="btn" onclick="nextStep()">–î–∞–ª–µ–µ ‚Üí</button>
                    </div>
                </div>
                
                <div class="form-step" id="step6">
                    <h2 class="step-title"><i class="fas fa-eye"></i> –ü—Ä–µ–≤—å—é –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h2>
                    
                    <div class="preview-item"><div class="preview-label">–§–æ—Ç–æ</div><div id="previewPhotos" class="photos-grid"></div></div>
                    <div class="preview-item"><div class="preview-label">–û–ø–∏—Å–∞–Ω–∏–µ</div><div class="preview-value" id="previewDescription"></div></div>
                    <div class="preview-item"><div class="preview-label">–¶–µ–Ω–∞</div><div class="preview-value" id="previewPrice"></div></div>
                    <div class="preview-item"><div class="preview-label">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div><div class="preview-value" id="previewContacts"></div></div>
                    <div class="preview-item"><div class="preview-label">–õ–æ–∫–∞—Ü–∏—è</div><div class="preview-value" id="previewLocation"></div></div>
                    
                    <div class="navigation">
                        <button class="btn btn-secondary" onclick="prevStep()">‚Üê –ù–∞–∑–∞–¥</button>
                        <button class="btn" onclick="submitForm()" id="submitBtn">üì§ –û–¢–ü–†–ê–í–ò–¢–¨ –í –ö–ê–ù–ê–õ</button>
                    </div>
                </div>
            </div>

            <!-- –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ -->
            <div class="form-container" id="successScreen" style="display: none;">
                <div class="success-screen">
                    <i class="fas fa-check-circle success-icon"></i>
                    <h2 class="success-title">–£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!</h2>
                    <div class="success-message" id="successMessageText">
                        ‚úÖ <b>–í–∞—à–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!</b><br><br>
                        üîó <b>–ö–∞–Ω–∞–ª:</b> @flowers_kg<br><br>
                        –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ Telegram –±–æ—Ç–∞ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                    </div>
                    
                    <button class="btn" onclick="closeApp()" style="margin-top: 30px;">
                        <i class="fas fa-check"></i> –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                </div>
            </div>

            <!-- –≠–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏ -->
            <div class="form-container" id="errorScreen" style="display: none;">
                <div class="error-screen">
                    <i class="fas fa-exclamation-circle error-icon"></i>
                    <h2 class="error-title">–û—à–∏–±–∫–∞</h2>
                    <div class="error-message" id="errorMessageText">
                        –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ.
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button class="btn btn-secondary" onclick="retrySubmit()">
                            <i class="fas fa-redo"></i> –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                        </button>
                        <button class="btn" onclick="closeApp()">
                            <i class="fas fa-times"></i> –ó–∞–∫—Ä—ã—Ç—å
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –£–ü–†–û–©–ï–ù–ù–´–ô JavaScript - –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        let formData = {
            photos: [],
            description: '',
            price: '',
            contact_type: 'telegram',
            contacts: '',
            location: '–ù–µ —É–∫–∞–∑–∞–Ω–æ'
        };
        
        let currentStep = 1;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram Web App
        let tg = null;
        if (window.Telegram && window.Telegram.WebApp) {
            tg = window.Telegram.WebApp;
            tg.expand();
            tg.MainButton.hide();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –ï—Å–ª–∏ –µ—Å—Ç—å Telegram, –∏—Å–ø–æ–ª—å–∑—É–µ–º username
            if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user && tg.initDataUnsafe.user.username) {
                formData.contacts = `@${tg.initDataUnsafe.user.username}`;
                document.getElementById('telegramInfo').style.display = 'block';
                document.getElementById('telegramInfo').innerHTML = `<i class="fab fa-telegram"></i> –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤–∞—à Telegram: @${tg.initDataUnsafe.user.username}`;
            }
            
            selectContactType('telegram');
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–æ—Ç–æ
            document.getElementById('photoUpload').addEventListener('click', () => {
                document.getElementById('photoInput').click();
            });
            
            document.getElementById('photoInput').addEventListener('change', handlePhotoUpload);
        });
        
        // –§—É–Ω–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function showStep(step) {
            document.querySelectorAll('.form-step').forEach(el => el.classList.remove('active'));
            document.getElementById(`step${step}`).classList.add('active');
            currentStep = step;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
            document.querySelectorAll('.step-number').forEach((num, idx) => {
                if (idx + 1 <= step) num.classList.add('active');
                else num.classList.remove('active');
            });
            
            document.querySelectorAll('.step-label').forEach((label, idx) => {
                if (idx + 1 <= step) label.classList.add('active');
                else label.classList.remove('active');
            });
            
            if (step === 6) updatePreview();
        }
        
        function nextStep() {
            if (!validateStep(currentStep)) return;
            saveCurrentStep();
            if (currentStep < 6) showStep(currentStep + 1);
        }
        
        function prevStep() {
            if (currentStep > 1) showStep(currentStep - 1);
        }
        
        function saveCurrentStep() {
            switch(currentStep) {
                case 2: formData.description = document.getElementById('description').value.trim(); break;
                case 3: formData.price = document.getElementById('price').value.trim(); break;
                case 4: 
                    if (formData.contact_type === 'phone') {
                        formData.contacts = document.getElementById('phone').value.trim();
                    }
                    break;
                case 5: formData.location = document.getElementById('locationInput').value.trim() || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'; break;
            }
        }
        
        function validateStep(step) {
            switch(step) {
                case 1:
                    if (formData.photos.length === 0) {
                        showNotification('–û—à–∏–±–∫–∞', '–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Ñ–æ—Ç–æ');
                        return false;
                    }
                    break;
                case 2:
                    const desc = document.getElementById('description').value.trim();
                    if (desc.length < 10) {
                        showNotification('–û—à–∏–±–∫–∞', '–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 10 —Å–∏–º–≤–æ–ª–æ–≤');
                        return false;
                    }
                    break;
                case 3:
                    if (!document.getElementById('price').value.trim()) {
                        showNotification('–û—à–∏–±–∫–∞', '–£–∫–∞–∂–∏—Ç–µ —Ü–µ–Ω—É');
                        return false;
                    }
                    break;
                case 4:
                    if (formData.contact_type === 'phone') {
                        const phone = document.getElementById('phone').value.trim();
                        if (!phone) {
                            showNotification('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
                            return false;
                        }
                    }
                    break;
            }
            return true;
        }
        
        function selectContactType(type) {
            formData.contact_type = type;
            
            const telegramBtn = document.getElementById('btnTelegram');
            const phoneBtn = document.getElementById('btnPhone');
            const phoneInput = document.getElementById('phoneInput');
            const telegramInfo = document.getElementById('telegramInfo');
            
            if (type === 'telegram') {
                telegramBtn.style.background = '#0088cc';
                telegramBtn.style.color = 'white';
                telegramBtn.style.border = '2px solid #0088cc';
                phoneBtn.style.background = '#f8f8f8';
                phoneBtn.style.color = '#333';
                phoneBtn.style.border = '2px solid #e0e0e0';
                phoneInput.style.display = 'none';
                telegramInfo.style.display = 'block';
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º username –µ—Å–ª–∏ –µ—Å—Ç—å
                if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user && tg.initDataUnsafe.user.username) {
                    formData.contacts = `@${tg.initDataUnsafe.user.username}`;
                    telegramInfo.innerHTML = `<i class="fab fa-telegram"></i> –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤–∞—à Telegram: @${tg.initDataUnsafe.user.username}`;
                }
            } else {
                phoneBtn.style.background = '#0088cc';
                phoneBtn.style.color = 'white';
                phoneBtn.style.border = '2px solid #0088cc';
                telegramBtn.style.background = '#f8f8f8';
                telegramBtn.style.color = '#333';
                telegramBtn.style.border = '2px solid #e0e0e0';
                phoneInput.style.display = 'block';
                telegramInfo.style.display = 'none';
                formData.contacts = document.getElementById('phone').value.trim() || '';
            }
        }
        
        function handlePhotoUpload(event) {
            const files = Array.from(event.target.files);
            files.forEach(file => {
                if (formData.photos.length >= 10) {
                    showNotification('–í–Ω–∏–º–∞–Ω–∏–µ', '–ú–∞–∫—Å–∏–º—É–º 10 —Ñ–æ—Ç–æ');
                    return;
                }
                
                if (!file.type.startsWith('image/')) {
                    showNotification('–û—à–∏–±–∫–∞', '–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    formData.photos.push(e.target.result);
                    updatePhotoPreview();
                };
                reader.readAsDataURL(file);
            });
            event.target.value = '';
        }
        
        function updatePhotoPreview() {
            const preview = document.getElementById('photoPreview');
            preview.innerHTML = '';
            
            formData.photos.forEach((photo, index) => {
                const div = document.createElement('div');
                div.className = 'photo-item';
                div.innerHTML = `
                    <img src="${photo}" alt="–§–æ—Ç–æ ${index + 1}">
                    <div class="remove-photo" onclick="removePhoto(${index})">√ó</div>
                `;
                preview.appendChild(div);
            });
        }
        
        function removePhoto(index) {
            formData.photos.splice(index, 1);
            updatePhotoPreview();
        }
        
        function updatePreview() {
            const previewPhotos = document.getElementById('previewPhotos');
            previewPhotos.innerHTML = '';
            
            formData.photos.slice(0, 6).forEach((photo, index) => {
                const img = document.createElement('img');
                img.className = 'photo-preview';
                img.src = photo;
                img.alt = `–§–æ—Ç–æ ${index + 1}`;
                previewPhotos.appendChild(img);
            });
            
            if (formData.photos.length > 6) {
                const more = document.createElement('div');
                more.className = 'photo-preview photo-more';
                more.textContent = `+${formData.photos.length - 6}`;
                previewPhotos.appendChild(more);
            }
            
            document.getElementById('previewDescription').textContent = formData.description || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            document.getElementById('previewPrice').textContent = formData.price || '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
            
            let contactsText = '';
            if (formData.contact_type === 'telegram') {
                contactsText = `Telegram: ${formData.contacts || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}`;
            } else {
                contactsText = `–¢–µ–ª–µ—Ñ–æ–Ω: ${formData.contacts || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}`;
            }
            document.getElementById('previewContacts').textContent = contactsText;
            document.getElementById('previewLocation').textContent = formData.location;
        }
        
        // –û–¢–ü–†–ê–í–ö–ê –§–û–†–ú–´ - –ü–†–û–°–¢–û–ô –ú–ï–¢–û–î
        async function submitForm() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
            if (!formData.description || formData.description.length < 10) {
                showNotification('–û—à–∏–±–∫–∞', '–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 10 —Å–∏–º–≤–æ–ª–æ–≤');
                return;
            }
            
            if (!formData.price) {
                showNotification('–û—à–∏–±–∫–∞', '–£–∫–∞–∂–∏—Ç–µ —Ü–µ–Ω—É');
                return;
            }
            
            if (!formData.contacts) {
                showNotification('–û—à–∏–±–∫–∞', '–£–∫–∞–∂–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            const btn = document.getElementById('submitBtn');
            btn.disabled = true;
            btn.innerHTML = '<div class="loader"></div> –û—Ç–ø—Ä–∞–≤–∫–∞...';
            
            // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            const dataToSend = {
                description: formData.description,
                price: formData.price,
                contact_type: formData.contact_type,
                contacts: formData.contacts,
                location: { address: formData.location },
                photos: formData.photos,
                timestamp: Date.now(),
                ad_id: `AD_${Date.now()}_${Math.floor(Math.random() * 1000)}`
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
                dataToSend.user = {
                    id: tg.initDataUnsafe.user.id,
                    first_name: tg.initDataUnsafe.user.first_name,
                    last_name: tg.initDataUnsafe.user.last_name,
                    username: tg.initDataUnsafe.user.username
                };
            }
            
            console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö:', dataToSend);
            
            // –ü–†–û–°–¢–û–ô –ú–ï–¢–û–î: –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–∫—Ä—ã—Ç–∏–µ —Å—Å—ã–ª–∫–∏
            try {
                // –ö–æ–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤ URL
                const encodedData = encodeURIComponent(JSON.stringify(dataToSend));
                
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É —Å –¥–∞–Ω–Ω—ã–º–∏
                if (tg && tg.openLink) {
                    tg.openLink(`https://t.me/flowers_kyrgyz_bot?start=ad_${dataToSend.ad_id}`);
                } else {
                    window.open(`https://t.me/flowers_kyrgyz_bot?start=ad_${dataToSend.ad_id}`, '_blank');
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö
                document.getElementById('formContainer').style.display = 'none';
                document.getElementById('successScreen').style.display = 'block';
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    if (tg && tg.close) {
                        tg.close();
                    }
                }, 3000);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏
                document.getElementById('formContainer').style.display = 'none';
                document.getElementById('errorScreen').style.display = 'block';
                document.getElementById('errorMessageText').textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –±–æ—Ç–∞ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞';
                
                btn.disabled = false;
                btn.innerHTML = 'üì§ –û–¢–ü–†–ê–í–ò–¢–¨ –í –ö–ê–ù–ê–õ';
            }
        }
        
        function showNotification(title, message, type = 'error') {
            const notification = document.getElementById('notification');
            const titleEl = document.getElementById('notificationTitle');
            const messageEl = document.getElementById('notificationMessage');
            const icon = notification.querySelector('.notification-icon');
            
            titleEl.textContent = title;
            messageEl.textContent = message;
            
            notification.className = 'notification';
            if (type === 'success') {
                notification.classList.add('success');
                icon.className = 'fas fa-check-circle notification-icon';
            } else {
                icon.className = 'fas fa-exclamation-circle notification-icon';
            }
            
            notification.classList.add('show');
            setTimeout(() => notification.classList.remove('show'), 3000);
        }
        
        function retrySubmit() {
            document.getElementById('errorScreen').style.display = 'none';
            document.getElementById('formContainer').style.display = 'block';
            showStep(6);
        }
        
        function closeApp() {
            if (tg && tg.close) {
                tg.close();
            }
        }
    </script>
</body>
</html>